# Needed to enable Travis CI for gh-pages branches, see:
#   https://github.com/travis-ci/travis-core/pull/137
branches:
  only:
    - gh-pages

script:
  - ./ci.py --pants-version unspecified
  - ./ci.py --pants-version pants.ini

osx_setup: &osx_setup
  os: osx
  language: generic
  addons:
    brew:
      packages:
        - openssl
  env:
    - &env_pyenv >
      PYENV_ROOT="${HOME}/.pyenv"
      PATH="${PYENV_ROOT}/shims:${PATH}"
    - >
      # These flags are necessary to get OpenSSL working. See
      # https://github.com/pyenv/pyenv/wiki/Common-build-problems#error-the-python-ssl-extension-was-not-compiled-missing-the-openssl-lib.
      PATH="/usr/local/opt/openssl/bin:$PATH"
      LDFLAGS="-L/usr/local/opt/openssl/lib"
      CPPFLAGS="-I/usr/local/opt/openssl/include"
  before_install:
    - &pyenv_install_py36 >
      git clone https://github.com/pyenv/pyenv ${PYENV_ROOT}
      && ${PYENV_ROOT}/bin/pyenv install 3.6.8
      && ${PYENV_ROOT}/bin/pyenv global 3.6.8

linux_setup: &linux_setup
  os: linux
  language: python
  python:
    - "2.7"
    - "3.6"
  sudo: false

matrix:
  include:
    - name: "OSX 10.11 - El Capitan"
      <<: *osx_setup
      osx_image: xcode8.0

    - name: "OSX 10.12 - Sierra"
      <<: *osx_setup
      osx_image: xcode9.2

    - name: "OSX 10.13 - High Sierra"
      <<: *osx_setup
      osx_image: xcode9.4

    - name: "Ubuntu 12.04 - Precise"
      <<: *linux_setup
      dist: precise
      sudo: required

    - name: "Ubuntu 14.04 - Trusty"
      <<: *linux_setup
      dist: trusty

    - name: "Ubuntu 16.04 - Xenial"
      <<: *linux_setup
      dist: xenial
